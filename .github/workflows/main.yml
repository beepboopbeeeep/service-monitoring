name: ğŸš€ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§

on:
  schedule:
    # Ù‡Ø± 10 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯
    - cron: '*/10 * * * *'
  # Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ
  workflow_dispatch:
  # Ù‡Ù†Ú¯Ø§Ù… Push ØªØºÛŒÛŒØ±Ø§Øª
  push:
    branches: [ main ]

jobs:
  monitor:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯Ù‡Ø§
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: ğŸ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: ğŸ“¦ Ù†ØµØ¨ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
      run: |
        python -m pip install --upgrade pip
        pip install requests
    
    - name: ğŸ” Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯
      run: python monitor.py
      env:
        PYTHONUNBUFFERED: 1
    
    - name: ğŸ’¾ Ø¨Ø±Ø±Ø³ÛŒ ØªØºÛŒÛŒØ±Ø§Øª
      id: git-check
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add -A
        if git diff --quiet && git diff --staged --quiet; then
          echo "changes=false" >> $GITHUB_OUTPUT
        else
          echo "changes=true" >> $GITHUB_OUTPUT
          git commit -m "ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ $(date +'%Y-%m-%d %H:%M:%S')"
        fi
    
    - name: ğŸ“¤ Ø¢Ù¾Ù„ÙˆØ¯ ØªØºÛŒÛŒØ±Ø§Øª
      if: steps.git-check.outputs.changes == 'true'
      run: git push
    
    - name: ğŸ“Š ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´
      if: always()
      run: |
        echo "ğŸš€ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ú©Ø§Ù…Ù„ Ø´Ø¯!"
        echo "ğŸ“… Ø²Ù…Ø§Ù†: $(date)"
        echo "ğŸ“ˆ Ù„ÛŒÙ†Ú© Ù¾Ù†Ù„: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
    
    - name: ğŸ¯ Ø§Ø±Ø³Ø§Ù„ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
      if: failure()
      run: |
        echo "âŒ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯"
        echo "Ù„Ø·ÙØ§Ù‹ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯"

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Operations Center</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0f172a; --card: #1e293b; --accent: #38bdf8;
            --success: #10b981; --warn: #f59e0b; --danger: #ef4444; --text: #f1f5f9;
        }
        body {
            background-color: var(--bg); color: var(--text); font-family: 'Vazirmatn', sans-serif;
            margin: 0; padding: 20px; line-height: 1.6;
        }
        .container { max-width: 1100px; margin: 0 auto; }
        
        /* Header & Stats */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .live-indicator { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: var(--success); }
        .dot { width: 10px; height: 10px; background: var(--success); border-radius: 50%; box-shadow: 0 0 10px var(--success); animation: pulse 1.5s infinite; }

        .top-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #334155; text-align: center; }
        .stat-card h3 { margin: 0; font-size: 0.8rem; opacity: 0.7; }
        .stat-card p { margin: 10px 0 0; font-size: 1.8rem; font-weight: bold; color: var(--accent); }

        /* Charts Section */
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .chart-box { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid #334155; height: 250px; }
        .chart-box h4 { margin: 0 0 15px; font-size: 0.9rem; border-right: 3px solid var(--accent); padding-right: 10px; }

        /* Creative Tips Section */
        .creative-tips { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 40px; }
        .tip-card { 
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            padding: 20px; border-radius: 15px; border-bottom: 4px solid var(--accent);
            transition: transform 0.3s; cursor: default;
        }
        .tip-card:hover { transform: translateY(-5px); }
        .tip-icon { font-size: 2rem; margin-bottom: 10px; display: block; }
        .tip-card h5 { margin: 0 0 10px; color: var(--accent); }
        .tip-card p { margin: 0; font-size: 0.85rem; opacity: 0.8; }

        /* Server Cards */
        .server-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .server-card { background: var(--card); border-radius: 18px; padding: 20px; border: 1px solid #334155; transition: 0.3s; }
        .server-card:hover { border-color: var(--accent); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .status-pill { padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; }
        .pill-active { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .pill-inactive { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        
        .sparkline-container { height: 50px; margin: 15px 0; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        @media (max-width: 600px) { .charts-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1 style="margin:0; font-size: 1.5rem;">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¨Ú©Ù‡</h1>
            <div id="last-update" style="font-size: 0.8rem; opacity: 0.6;"></div>
        </div>
        <div class="live-indicator">
            <div class="dot"></div> Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø²Ù†Ø¯Ù‡ ÙØ¹Ø§Ù„ Ø§Ø³Øª
        </div>
    </header>

    <div class="top-stats">
        <div class="stat-card"><h3>Ú©Ù„ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§</h3><p id="total-count">Û°</p></div>
        <div class="stat-card"><h3>Ø¢Ù¾ØªØ§ÛŒÙ… Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†</h3><p id="avg-uptime">Û°Ùª</p></div>
        <div class="stat-card"><h3>ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…</h3><p style="color:var(--success)">Ù¾Ø§ÛŒØ¯Ø§Ø±</p></div>
    </div>

    <div class="charts-grid">
        <div class="chart-box"><h4>Ø±ÙˆÙ†Ø¯ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Û· Ø±ÙˆØ² Ø§Ø®ÛŒØ±</h4><canvas id="weeklyChart"></canvas></div>
        <div class="chart-box"><h4>Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Û³Û° Ø±ÙˆØ²Ù‡ Ú©Ù„ Ø³ÛŒØ³ØªÙ…</h4><canvas id="monthlyChart"></canvas></div>
    </div>

    <div class="creative-tips">
        <div class="tip-card">
            <span class="tip-icon">ğŸš€</span>
            <h5>ØªØ±Ø§ÙÛŒÚ© Ù‡ÙˆØ´Ù…Ù†Ø¯</h5>
            <p>Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨ÛŒÙ† Ù†ÙˆØ¯Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¬Ø§Ø¨Ø¬Ø§ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ ØªØ§ Ø³Ø±Ø¹Øª Ø´Ù…Ø§ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ø³Ø·Ø­ Ø¨Ù…Ø§Ù†Ø¯.</p>
        </div>
        <div class="tip-card" style="border-color: var(--warn);">
            <span class="tip-icon">ğŸ›¡ï¸</span>
            <h5>Ø§Ù…Ù†ÛŒØª Ù„Ø§ÛŒÙ‡ Û·</h5>
            <p>ØªÙ…Ø§Ù… Ø§ØªØµØ§Ù„â€ŒÙ‡Ø§ Ø¨Ø§ Ù¾Ø±ÙˆØªÚ©Ù„â€ŒÙ‡Ø§ÛŒ Ù†ÙˆÛŒÙ† Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯. Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ Ø´Ù…Ø§ Ø®Ø· Ù‚Ø±Ù…Ø² Ù…Ø§Ø³Øª.</p>
        </div>
        <div class="tip-card" style="border-color: var(--success);">
            <span class="tip-icon">ğŸ’</span>
            <h5>Ú¯Ø§Ø±Ø§Ù†ØªÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª</h5>
            <p>Ø¯Ø± ØµÙˆØ±Øª Ø§ÙØª Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø¨Ù‡ Ø²ÛŒØ± Û¹Û¹ÙªØŒ Ø²Ù…Ø§Ù† Ù‡Ø¯ÛŒÙ‡ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú© Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.</p>
        </div>
    </div>

    <div id="server-grid" class="server-grid"></div>
</div>

<script>
    const toPersian = n => String(n).replace(/\d/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'[d]);

    fetch('status_data.json?v=' + Date.now())
        .then(r => r.json())
        .then(data => {
            document.getElementById('last-update').innerText = 'Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ' + toPersian(data.last_updated);
            document.getElementById('total-count').innerText = toPersian(data.servers.length);
            
            // Ø±Ø³Ù… Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ú©Ù„ÛŒ
            const days = Object.keys(data.global_history);
            const scores = Object.values(data.global_history);
            
            document.getElementById('avg-uptime').innerText = toPersian(scores[scores.length-1] || 0) + 'Ùª';

            renderMainChart('weeklyChart', days.slice(-7), scores.slice(-7), '#38bdf8');
            renderMainChart('monthlyChart', days, scores, '#818cf8');

            // Ø±Ù†Ø¯Ø± Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø±ÙˆØ±
            const grid = document.getElementById('server-grid');
            data.servers.forEach((s, idx) => {
                const isUp = s.status_code === 'active';
                grid.innerHTML += `
                    <div class="server-card">
                        <div class="card-header">
                            <span style="font-weight:bold">${s.name}</span>
                            <span class="status-pill ${isUp ? 'pill-active' : 'pill-inactive'}">
                                ${isUp ? 'â— Ø¢Ù†Ù„Ø§ÛŒÙ†' : 'â—‹ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª'}
                            </span>
                        </div>
                        <div class="sparkline-container"><canvas id="spark-${idx}"></canvas></div>
                        <div style="font-size:0.8rem; opacity:0.7; display:flex; justify-content:space-between">
                            <span>ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§: ${toPersian(s.expiry_date)}</span>
                            <span>ÙˆØ¶Ø¹ÛŒØª: ${s.status_text}</span>
                        </div>
                    </div>
                `;
                
                setTimeout(() => renderSparkline(`spark-${idx}`, s.history, isUp ? '#10b981' : '#ef4444'), 100);
            });
        });

    function renderMainChart(id, labels, data, color) {
        new Chart(document.getElementById(id), {
            type: 'line',
            data: {
                labels: labels.map(l => l.split('/')[2]), // ÙÙ‚Ø· Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆØ²
                datasets: [{
                    data: data, borderColor: color, tension: 0.4, fill: true,
                    backgroundColor: color + '22', borderWidth: 2, pointRadius: 4
                }]
            },
            options: {
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { min: 0, max: 100, ticks: { stepSize: 25 } }, x: { grid: { display: false } } }
            }
        });
    }

    function renderSparkline(id, history, color) {
        const ctx = document.getElementById(id);
        const data = history.map(h => h === 'active' ? 1 : 0);
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: data,
                datasets: [{ data: data, borderColor: color, borderWidth: 2, tension: 0.3, pointRadius: 0, fill: false }]
            },
            options: {
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { x: { display: false }, y: { display: false, min: -0.2, max: 1.2 } }
            }
        });
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙˆØ¶Ø¹ÛŒØª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø³Ø±ÙˆØ±Ù‡Ø§</title>
    <link href="https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment/moment.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-jalaali/build/moment-jalaali.js"></script>

    <style>
        :root {
            --bg-color: #1E1E1E;
            --accent-color: #C7A46C;
            --text-color: #ffffff;
            --card-bg: #2d2d2d;
            --success: #00C851;
            --warning: #ffbb33;
            --danger: #ff4444;
            --orange: #FF8800;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Vazir', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        h1 {
            color: var(--accent-color);
            text-align: center;
            margin-bottom: 10px;
            font-weight: 900;
            text-shadow: 0 0 10px rgba(199, 164, 108, 0.3);
        }

        /* Ø¨Ø®Ø´ Ø±Ø§Ù‡Ù†Ù…Ø§ Ùˆ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ */
        .info-box {
            background: rgba(199, 164, 108, 0.1);
            border: 1px solid var(--accent-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 30px;
            font-size: 0.9em;
            line-height: 1.8;
            backdrop-filter: blur(5px);
        }

        .info-box ul {
            margin: 0;
            padding-right: 20px;
        }

        .highlight {
            color: var(--accent-color);
            font-weight: bold;
        }

        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø±ÙˆÛŒØ³ */
        .status-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }

        .service-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-right: 4px solid transparent;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }

        .service-name {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--accent-color);
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-badge.active { background: rgba(0, 200, 81, 0.2); color: var(--success); border: 1px solid var(--success); }
        .status-badge.warning { background: rgba(255, 187, 51, 0.2); color: var(--warning); border: 1px solid var(--warning); }
        .status-badge.inactive { background: rgba(255, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); }

        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            font-size: 0.9em;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            opacity: 0.6;
            font-size: 0.8em;
            margin-bottom: 3px;
        }

        .detail-value {
            font-weight: bold;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª ØªÙ…Ø¯ÛŒØ¯ */
        .renewal-normal { color: var(--text-color); }
        .renewal-near { color: var(--warning); text-shadow: 0 0 5px rgba(255, 187, 51, 0.5); }
        .renewal-today { color: var(--orange); font-weight: 900; animation: pulse 2s infinite; }
        .renewal-overdue { color: var(--danger); }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ */
        .charts-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .charts-title {
            color: var(--accent-color);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .last-update {
            text-align: center;
            margin-top: 30px;
            opacity: 0.5;
            font-size: 0.8em;
        }

        /* Loading */
        #loading {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(199, 164, 108, 0.3);
            border-top: 5px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div id="loading"><div class="spinner"></div></div>

    <div class="container">
        <h1>ÙˆØ¶Ø¹ÛŒØª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø³Ø±ÙˆØ±Ù‡Ø§</h1>

        <div class="info-box">
            <h3>ğŸ“Œ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†:</h3>
            <ul>
                <li>Ø§Ú¯Ø± ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆÛŒØ³ <span style="color:var(--success)">ÙØ¹Ø§Ù„</span> Ø§Ø³Øª: ØªØ¨Ø±ÛŒÚ©! Ø³Ø±ÙˆÛŒØ³ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ùˆ Ù¾Ø±Ø³Ø±Ø¹Øª Ø¯Ø± Ø­Ø§Ù„ Ú©Ø§Ø± Ø§Ø³Øª.</li>
                <li>Ø§Ú¯Ø± Ø¨Ø§ Ù¾ÛŒØ§Ù… <span style="color:var(--warning)">Ø³Ù†Ú¯ÛŒÙ†ÛŒ Ø¨Ø§Ø± Ø³Ø±ÙˆØ±</span> Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯ÛŒØ¯: Ø§ØµÙ„Ø§Ù‹ Ù†Ú¯Ø±Ø§Ù† Ù†Ø¨Ø§Ø´ÛŒØ¯. ÙÙ‚Ø· ØªØ§ Ø³Ø§Ø¹Øª Û³:Û³Û° Ø§Ù„ÛŒ Û´:Û°Û° Ø¨Ø§Ù…Ø¯Ø§Ø¯ ØµØ¨Ø± Ú©Ù†ÛŒØ¯ ØªØ§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´ÙˆØ¯.</li>
                <li>Ø§Ú¯Ø± ÙˆØ¶Ø¹ÛŒØª <span style="color:var(--danger)">ØºÛŒØ±ÙØ¹Ø§Ù„</span> Ø§Ø³Øª: Ù„Ø·ÙØ§Ù‹ Ø¨Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù¾ÛŒØ§Ù… Ø¯Ù‡ÛŒØ¯.</li>
                <li>âš ï¸ Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ù‚Ø·Ø¹ÛŒØŒ Ø²Ù…Ø§Ù† Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡ Ø¨Ù‡ Ø§Ø¹ØªØ¨Ø§Ø± Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù†Ú¯Ø±Ø§Ù† Ø¶Ø±Ø± Ù…Ø§Ù„ÛŒ Ù†Ø¨Ø§Ø´ÛŒØ¯.</li>
                <li>ğŸ Ø¨Ø§ Ù…Ø¹Ø±ÙÛŒ Ø¯ÙˆØ³ØªØ§Ù† Ø®ÙˆØ¯ØŒ ÙˆØ§Ø¬Ø¯ Ø´Ø±Ø§ÛŒØ· <strong>ØªØ®ÙÛŒÙ ÙˆÛŒÚ˜Ù‡</strong> Ø¯Ø± ØªÙ…Ø¯ÛŒØ¯ Ù…Ø§Ù‡ÛŒØ§Ù†Ù‡ Ø´ÙˆÛŒØ¯!</li>
            </ul>
        </div>

        <div id="servers-container" class="status-grid">
            </div>

        <div class="charts-container">
            <div class="charts-title">ğŸ“Š Ù†Ù…ÙˆØ¯Ø§Ø± Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ (Û· Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡)</div>
            <div class="chart-wrapper">
                <canvas id="uptimeChart"></canvas>
            </div>
        </div>

        <div class="last-update" id="last-update-time"></div>
    </div>

    <script>
        // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ
        function toPersianNum(num) {
            const farsiDigits = ['Û°', 'Û±', 'Û²', 'Û³', 'Û´', 'Ûµ', 'Û¶', 'Û·', 'Û¸', 'Û¹'];
            return num.toString().replace(/\d/g, x => farsiDigits[x]);
        }

        // Ù…Ø­Ø§Ø³Ø¨Ø§Øª ØªØ§Ø±ÛŒØ® ØªÙ…Ø¯ÛŒØ¯
        function calculateRenewal(renewalDateStr) {
            if (renewalDateStr === 'unlimited') {
                return { text: 'Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯', class: 'renewal-normal', days: null };
            }

            // ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ù‡ Ø¢Ø¨Ø¬Ú©Øª moment
            const renewalDate = moment(renewalDateStr, 'jYYYY/jMM/jDD');
            const today = moment();
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø®ØªÙ„Ø§Ù Ø±ÙˆØ²
            const diffDays = renewalDate.diff(today, 'days');

            if (diffDays > 10) {
                return { 
                    text: `${toPersianNum(diffDays)} Ø±ÙˆØ² Ù…Ø§Ù†Ø¯Ù‡ (${toPersianNum(renewalDateStr)})`, 
                    class: 'renewal-normal',
                    days: diffDays
                };
            } else if (diffDays > 0 && diffDays <= 10) {
                return { 
                    text: `âš ï¸ ØªÙ†Ù‡Ø§ ${toPersianNum(diffDays)} Ø±ÙˆØ² Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡!`, 
                    class: 'renewal-near',
                    days: diffDays
                };
            } else if (diffDays === 0) {
                return { 
                    text: 'ğŸ”¥ Ø§Ù…Ø±ÙˆØ² Ø±ÙˆØ² ØªÙ…Ø¯ÛŒØ¯ Ø§Ø³Øª!', 
                    class: 'renewal-today',
                    days: 0
                };
            } else {
                return { 
                    text: `â›” ${toPersianNum(Math.abs(diffDays))} Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡ (Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ…Ø¯ÛŒØ¯ ÙÙˆØ±ÛŒ)`, 
                    class: 'renewal-overdue',
                    days: diffDays
                };
            }
        }

        // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
        async function init() {
            try {
                // Ø¯Ø±ÛŒØ§ÙØª Ø¯ÛŒØªØ§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· GitHub Actions
                const response = await fetch('data.json');
                const data = await response.json();
                
                renderServers(data.servers);
                renderChart(data.history, data.servers);
                
                const updateTime = new Date(data.lastUpdate);
                document.getElementById('last-update-time').innerHTML = 
                    `Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ${toPersianNum(updateTime.toLocaleTimeString('fa-IR'))}`;

            } catch (error) {
                console.error("Error loading data:", error);
                document.getElementById('servers-container').innerHTML = '<p style="text-align:center">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯.</p>';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        function renderServers(servers) {
            const container = document.getElementById('servers-container');
            container.innerHTML = '';

            servers.forEach(srv => {
                const renewalInfo = calculateRenewal(srv.renewalDate);
                
                let statusClass = '';
                let statusIcon = '';
                
                if (srv.currentStatus === 'active') {
                    statusClass = 'active';
                    statusIcon = 'âœ…';
                } else if (srv.currentStatus === 'warning') {
                    statusClass = 'warning';
                    statusIcon = 'âš ï¸';
                } else {
                    statusClass = 'inactive';
                    statusIcon = 'â›”';
                }

                // ØªØ¹ÛŒÛŒÙ† Ø±Ù†Ú¯ Ø­Ø§Ø´ÛŒÙ‡ Ø±Ø§Ø³Øª Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª
                let borderColor = statusClass === 'active' ? 'var(--success)' : (statusClass === 'warning' ? 'var(--warning)' : 'var(--danger)');

                const html = `
                    <div class="service-card" style="border-right-color: ${borderColor}">
                        <div class="card-header">
                            <span class="service-name">${srv.name}</span>
                            <span class="status-badge ${statusClass}">
                                ${statusIcon} ${srv.currentMsg}
                            </span>
                        </div>
                        <div class="details-grid">
                            <div class="detail-item">
                                <span class="detail-label">ÙˆØ¶Ø¹ÛŒØª ØªÙ…Ø¯ÛŒØ¯:</span>
                                <span class="detail-value ${renewalInfo.class}">${renewalInfo.text}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Ú©Ø¯ Ù…Ø¹Ø±Ù (ØªØ®ÙÛŒÙ):</span>
                                <span class="detail-value" style="color:var(--accent-color)">${srv.referralCode || '-'}</span>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        function renderChart(history, servers) {
            const ctx = document.getElementById('uptimeChart').getContext('2d');
            
            // Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯ÛŒØªØ§Ø³Øªâ€ŒÙ‡Ø§
            const datasets = servers.map(srv => {
                // Ø±Ù†Ú¯ Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± ÛŒÙˆØ²Ø± (Ù‡Ø´ Ú©Ø±Ø¯Ù† Ù†Ø§Ù… Ø¨Ø±Ø§ÛŒ Ø«Ø¨Ø§Øª Ø±Ù†Ú¯ ÛŒØ§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶)
                const srvHistory = history[srv.id] || [];
                
                // ØªØ¨Ø¯ÛŒÙ„ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ù‡ Ø¹Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± (1: ÙØ¹Ø§Ù„ØŒ 0.5: ÙˆØ§Ø±Ù†ÛŒÙ†Ú¯ØŒ 0: Ù‚Ø·Ø¹)
                const dataPoints = srvHistory.map(h => {
                    if (h.s === 'active') return 1;
                    if (h.s === 'warning') return 0.5;
                    return 0;
                });

                // Ù„ÛŒØ¨Ù„â€ŒÙ‡Ø§ÛŒ Ø²Ù…Ø§Ù† (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø­ÙˆØ± X ÛŒÚ©ÛŒ Ú©Ø§ÙÛŒØ³Øª Ø§Ù…Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù…Ù¾ Ù…ÛŒÚ©Ù†ÛŒÙ…)
                // Ù…Ø§ ÙÙ‚Ø· Ø¯ÛŒØªØ§ Ù¾ÙˆÛŒÙ†Øª Ø¨Ø±Ù…ÛŒÚ¯Ø±Ø¯Ø§Ù†ÛŒÙ…ØŒ Ù„ÛŒØ¨Ù„â€ŒÙ‡Ø§ Ø±Ø§ Ø¬Ø¯Ø§ Ù…ÛŒØ³Ø§Ø²ÛŒÙ…
                
                let color = srv.id === 'server1' ? '#00C851' : '#33b5e5'; // Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…ÛŒ
                if (servers.indexOf(srv) > 1) color = '#ffbb33'; 

                return {
                    label: srv.name,
                    data: dataPoints,
                    borderColor: color,
                    backgroundColor: color + '20', // Ø´ÙØ§Ù
                    borderWidth: 2,
                    tension: 0.4, // Ù†Ø±Ù… Ú©Ø±Ø¯Ù† Ø®Ø·ÙˆØ· Ù…Ø«Ù„ ØªÙ„Ú¯Ø±Ø§Ù…
                    fill: true,
                    pointRadius: 0
                };
            });

            // Ø³Ø§Ø®Øª Ù„ÛŒØ¨Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø­ÙˆØ± X (Ø²Ù…Ø§Ù†)
            // ÙØ±Ø¶ Ù…ÛŒÚ©Ù†ÛŒÙ… Ù‡Ù…Ù‡ Ø³Ø±ÙˆØ±Ù‡Ø§ Ø¯Ø± ÛŒÚ© Ø²Ù…Ø§Ù† Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯Ù†Ø¯ØŒ Ø§Ø² Ù‡ÛŒØ³ØªÙˆØ±ÛŒ Ø§ÙˆÙ„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒÚ©Ù†ÛŒÙ…
            const firstSrvId = servers[0].id;
            const labels = (history[firstSrvId] || []).map(h => {
                const date = new Date(h.t);
                return toPersianNum(date.toLocaleDateString('fa-IR', {day: 'numeric', month: 'short'}));
            });

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#fff',
                                font: { family: 'Vazir' }
                            }
                        },
                        tooltip: {
                            titleFont: { family: 'Vazir' },
                            bodyFont: { family: 'Vazir' },
                            rtl: true
                        }
                    },
                    scales: {
                        y: {
                            display: false, // Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ø§Ø¹Ø¯Ø§Ø¯ Ù…Ø­ÙˆØ± Ø¹Ù…ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø²ÛŒØ¨Ø§ÛŒÛŒ
                            min: -0.1,
                            max: 1.2
                        },
                        x: {
                            ticks: {
                                color: 'rgba(255,255,255,0.5)',
                                font: { family: 'Vazir', size: 10 },
                                maxTicksLimit: 7 // Ø´Ù„ÙˆØº Ù†Ø´Ø¯Ù† Ù…Ø­ÙˆØ±
                            },
                            grid: {
                                color: 'rgba(255,255,255,0.05)'
                            }
                        }
                    }
                }
            });
        }

        init();
    </script>
</body>
</html>

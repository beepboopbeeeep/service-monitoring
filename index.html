<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ | Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
    
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-dark: #1E1E1E;
            --bg-card: #252525;
            --gold: #C7A46C;
            --gold-dim: rgba(199, 164, 108, 0.1);
            --text-main: #ffffff;
            --text-muted: #a1a1aa;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --orange: #f97316;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ Ù…Ø­Ùˆ */
        body::before {
            content: '';
            position: fixed;
            top: -20%;
            left: -20%;
            width: 60%;
            height: 60%;
            background: radial-gradient(circle, rgba(199,164,108,0.08) 0%, rgba(30,30,30,0) 70%);
            z-index: -1;
            pointer-events: none;
        }

        /* Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§ØµÙ„ÛŒ */
        .container {
            width: 100%;
            max-width: 1100px;
            padding: 20px;
            margin: 0 auto;
        }

        /* Ù‡Ø¯Ø± */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            position: relative;
        }
        
        h1 {
            font-size: 2.5rem;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(199,164,108,0.3);
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .update-badge {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 0.9rem;
            color: var(--text-muted);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(5px);
        }
        
        .update-badge span { color: var(--gold); font-weight: bold; }

        /* Ø±Ø§Ù‡Ù†Ù…Ø§ (Notification Box) */
        .notice-box {
            background: linear-gradient(135deg, rgba(42,42,42,0.9) 0%, rgba(30,30,30,0.9) 100%);
            border-right: 4px solid var(--gold);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }
        
        .notice-box h3 { color: var(--gold); margin-bottom: 15px; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .notice-box ul { list-style: none; padding-right: 10px; }
        .notice-box li { margin-bottom: 10px; font-size: 0.95rem; line-height: 1.6; color: #d1d5db; position: relative; padding-right: 15px; }
        .notice-box li::before { content: 'â€¢'; color: var(--gold); position: absolute; right: 0; font-weight: bold; }
        
        .hl-green { color: var(--success); font-weight: bold; }
        .hl-yellow { color: var(--warning); font-weight: bold; }
        .hl-red { color: var(--danger); font-weight: bold; }

        /* Ø¨Ø®Ø´ Ù†Ù…ÙˆØ¯Ø§Ø± Ú©Ù„ÛŒ */
        .global-chart-section {
            background: rgba(37, 37, 37, 0.6);
            border: 1px solid rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 40px;
            box-shadow: 0 20px 40px -20px rgba(0,0,0,0.6);
        }
        .chart-header { display: flex; justify-content: space-between; margin-bottom: 15px; align-items: center; }
        .chart-title { color: var(--gold); font-weight: bold; }

        /* Ú¯Ø±ÛŒØ¯ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
        }

        /* Ú©Ø§Ø±Øª Ø³Ø±ÙˆÛŒØ³ */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 25px;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255,255,255,0.03);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.4);
            border-color: rgba(199, 164, 108, 0.3);
        }

        /* Ø§ÙÚ©Øª Ù†Ø¦ÙˆÙ† Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª */
        .card.active { box-shadow: 0 0 0 1px rgba(16, 185, 129, 0.2), 0 10px 20px rgba(16, 185, 129, 0.05); }
        .card.warning { box-shadow: 0 0 0 1px rgba(245, 158, 11, 0.2), 0 10px 20px rgba(245, 158, 11, 0.05); }
        .card.inactive { box-shadow: 0 0 0 1px rgba(239, 68, 68, 0.2), 0 10px 20px rgba(239, 68, 68, 0.05); }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .service-name { font-size: 1.2rem; font-weight: 800; color: #fff; }
        
        .status-pill {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .status-pill.active { background: rgba(16, 185, 129, 0.15); color: var(--success); }
        .status-pill.warning { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
        .status-pill.inactive { background: rgba(239, 68, 68, 0.15); color: var(--danger); }

        .pulse-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
        .active .pulse-dot { background: var(--success); box-shadow: 0 0 10px var(--success); animation: pulse 2s infinite; }
        .warning .pulse-dot { background: var(--warning); animation: blink 1s infinite; }
        .inactive .pulse-dot { background: var(--danger); }

        .status-msg { font-size: 0.85rem; margin-bottom: 20px; min-height: 40px; }

        .info-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            padding: 12px 0;
            border-top: 1px solid rgba(255,255,255,0.05);
            color: var(--text-muted);
        }
        
        .val-gold { color: var(--gold); font-family: 'Courier New', monospace; font-weight: bold; }
        
        .days-left { font-weight: bold; }
        .days-left.normal { color: #d1d5db; }
        .days-left.near { color: var(--warning); }
        .days-left.today { color: var(--orange); }
        .days-left.expired { color: var(--danger); }

        /* Ù…ÛŒÙ†ÛŒ Ú†Ø§Ø±Øª */
        .mini-chart-container {
            height: 50px;
            margin-top: auto;
            opacity: 0.7;
            mask-image: linear-gradient(to right, transparent, black 10%);
        }

        /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ */
        @keyframes pulse { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.6; transform: scale(1.1); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        
        /* Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
        .loading { text-align: center; color: var(--gold); margin: 50px 0; font-size: 1.1rem; }

        /* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .container { padding: 15px; }
            .notice-box { padding: 15px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø³Ø±ÙˆØ±Ù‡Ø§</h1>
            <div class="update-badge">
                Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: <span id="last-update">...</span>
            </div>
        </header>

        <div class="notice-box">
            <h3>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
            <ul>
                <li>ÙˆØ¶Ø¹ÛŒØª <span class="hl-green">ÙØ¹Ø§Ù„</span>: Ø³Ø±ÙˆÛŒØ³ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ùˆ Ø¨Ø¯ÙˆÙ† Ù…Ø´Ú©Ù„ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</li>
                <li>ÙˆØ¶Ø¹ÛŒØª <span class="hl-yellow">Ø³Ù†Ú¯ÛŒÙ†ÛŒ Ø¨Ø§Ø± (Rate Limit)</span>: Ù†Ú¯Ø±Ø§Ù† Ù†Ø¨Ø§Ø´ÛŒØ¯! Ø§ÛŒÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù…ÙˆÙ‚Øª Ø§Ø³Øª Ùˆ Ø³Ø§Ø¹Øª Û³:Û³Û° ØªØ§ Û´:Û°Û° Ø¨Ø§Ù…Ø¯Ø§Ø¯ Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ø±ÙØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</li>
                <li>ÙˆØ¶Ø¹ÛŒØª <span class="hl-red">ØºÛŒØ±ÙØ¹Ø§Ù„</span>: Ù„Ø·ÙØ§Ù‹ Ø¬Ù‡Øª Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.</li>
                <li>Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ù‚Ø·Ø¹ÛŒØŒ Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø¢Ù† Ø¨Ù‡ Ø§Ø¹ØªØ¨Ø§Ø± Ø³Ø±ÙˆÛŒØ³ Ø´Ù…Ø§ <strong>Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯</strong>.</li>
                <li>ğŸ‰ Ø¨Ø§ Ù…Ø¹Ø±ÙÛŒ Ø¯ÙˆØ³ØªØ§Ù† Ø®ÙˆØ¯ØŒ ØªØ®ÙÛŒÙ ØªÙ…Ø¯ÛŒØ¯ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯.</li>
            </ul>
        </div>

        <div class="global-chart-section">
            <div class="chart-header">
                <span class="chart-title">ğŸ“Š Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ú©Ù„ÛŒ Ø´Ø¨Ú©Ù‡ (Û²Û´ Ø³Ø§Ø¹Øª Ú¯Ø°Ø´ØªÙ‡)</span>
            </div>
            <div style="height: 250px; width: 100%;">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <div id="services-container" class="services-grid">
            <div class="loading">
                <p>Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³...</p>
            </div>
        </div>
    </div>

    <script>
        // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ
        function toPersianNum(num) {
            if (num === null || num === undefined) return '';
            const id = ['Û°', 'Û±', 'Û²', 'Û³', 'Û´', 'Ûµ', 'Û¶', 'Û·', 'Û¸', 'Û¹'];
            return num.toString().replace(/[0-9]/g, function (w) { return id[+w] });
        }

        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„ÛŒ Ú†Ø§Ø±Øª
        Chart.defaults.font.family = 'Vazirmatn';
        Chart.defaults.color = '#a1a1aa';

        document.addEventListener('DOMContentLoaded', () => {
            fetch('data.json')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('last-update').textContent = toPersianNum(data.last_updated);
                    renderMainChart(data.global_history);
                    renderCards(data.services);
                })
                .catch(e => {
                    document.getElementById('services-container').innerHTML = 
                        '<p style="color:red; text-align:center; width:100%;">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</p>';
                    console.error(e);
                });
        });

        // Ø±Ø³Ù… Ù†Ù…ÙˆØ¯Ø§Ø± Ø§ØµÙ„ÛŒ Ø´Ø¨Ú©Ù‡
        function renderMainChart(history) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±Ø§Ø¯ÛŒÙ†Øª Ø·Ù„Ø§ÛŒÛŒ
            let gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(199, 164, 108, 0.4)');
            gradient.addColorStop(1, 'rgba(199, 164, 108, 0)');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: history.map(h => toPersianNum(h.time)),
                    datasets: [{
                        label: 'Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ',
                        data: history.map(h => h.score),
                        borderColor: '#C7A46C',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#252525',
                            titleColor: '#C7A46C',
                            bodyColor: '#fff',
                            borderColor: '#333',
                            borderWidth: 1,
                            titleFont: { family: 'Vazirmatn' },
                            bodyFont: { family: 'Vazirmatn' }
                        }
                    },
                    scales: {
                        x: { grid: { display: false } },
                        y: { 
                            min: 0, max: 100,
                            grid: { color: 'rgba(255,255,255,0.05)' } 
                        }
                    }
                }
            });
        }

        // Ø³Ø§Ø®Øª Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§
        function renderCards(services) {
            const container = document.getElementById('services-container');
            container.innerHTML = '';

            services.forEach(service => {
                // ØªØ¹ÛŒÛŒÙ† ÙˆØ¶Ø¹ÛŒØª Ùˆ Ø±Ù†Ú¯â€ŒÙ‡Ø§
                let statusClass = '', statusText = '', msg = '', msgColor = '';
                
                if (service.status === 'active') {
                    statusClass = 'active'; statusText = 'ÙØ¹Ø§Ù„';
                    msg = 'Ø³Ø±ÙˆÛŒØ³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù…ØªØµÙ„ Ø§Ø³Øª'; msgColor = 'color: #34d399';
                } else if (service.status === 'warning') {
                    statusClass = 'warning'; statusText = 'Ù…Ø­Ø¯ÙˆØ¯ÛŒØª';
                    msg = 'Ø³Ù†Ú¯ÛŒÙ†ÛŒ Ø¨Ø§Ø± Ø³Ø±ÙˆØ± (Ø±ÙØ¹ Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ§ Û´ Ø¨Ø§Ù…Ø¯Ø§Ø¯)'; msgColor = 'color: #fbbf24';
                } else {
                    statusClass = 'inactive'; statusText = 'ØºÛŒØ±ÙØ¹Ø§Ù„';
                    msg = 'Ù„Ø·ÙØ§Ù‹ Ø¨Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù¾ÛŒØ§Ù… Ø¯Ù‡ÛŒØ¯'; msgColor = 'color: #f87171';
                }

                // ØªØ¹ÛŒÛŒÙ† ÙˆØ¶Ø¹ÛŒØª ØªØ§Ø±ÛŒØ®
                let daysClass = 'normal', daysText = '';
                if (service.days_left === 9999) {
                    daysText = 'Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯';
                } else if (service.days_left < 0) {
                    daysClass = 'expired';
                    daysText = `${toPersianNum(Math.abs(service.days_left))} Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡`;
                } else if (service.days_left === 0) {
                    daysClass = 'today';
                    daysText = 'Ø§Ù…Ø±ÙˆØ² (Ø³Ø±Ø±Ø³ÛŒØ¯)';
                } else {
                    daysText = `${toPersianNum(service.days_left)} Ø±ÙˆØ²`;
                    if (service.days_left <= 10) daysClass = 'near';
                }

                const cardHTML = `
                    <div class="card ${statusClass}">
                        <div class="card-header">
                            <div class="service-name">${service.name}</div>
                            <div class="status-pill ${statusClass}">
                                <span class="pulse-dot"></span> ${statusText}
                            </div>
                        </div>
                        
                        <div class="status-msg" style="${msgColor}">${msg}</div>
                        
                        <div class="info-row">
                            <span>ØªØ§Ø±ÛŒØ® ØªÙ…Ø¯ÛŒØ¯:</span>
                            <span class="val-gold">${service.expiry_date === 'unlimited' ? 'Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯' : toPersianNum(service.expiry_date)}</span>
                        </div>
                        
                        <div class="info-row">
                            <span>Ø²Ù…Ø§Ù† Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡:</span>
                            <span class="days-left ${daysClass}">${daysText}</span>
                        </div>

                        <div class="mini-chart-container">
                            <canvas id="chart-${service.id}"></canvas>
                        </div>
                    </div>
                `;
                
                // ØªØ¨Ø¯ÛŒÙ„ string Ø¨Ù‡ element ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ DOM
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = cardHTML;
                const cardEl = tempDiv.firstElementChild;
                container.appendChild(cardEl);

                // Ø±Ø³Ù… Ù†Ù…ÙˆØ¯Ø§Ø± Ú©ÙˆÚ†Ú©
                renderSparkline(service.id, service.history, statusClass);
            });
        }

        function renderSparkline(id, history, statusClass) {
            const ctx = document.getElementById(`chart-${id}`).getContext('2d');
            let color = '#10b981'; // green default
            if (statusClass === 'warning') color = '#f59e0b';
            if (statusClass === 'inactive') color = '#ef4444';

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: history.map(() => ''),
                    datasets: [{
                        data: history,
                        borderColor: color,
                        borderWidth: 2,
                        tension: 0.3,
                        pointRadius: 0,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    scales: { x: { display: false }, y: { display: false, min: 0, max: 1.1 } }
                }
            });
        }
    </script>
</body>
</html>
